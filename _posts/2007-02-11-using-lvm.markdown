---
layout: post
title:  "Using LVM"
date:   2007-02-11 21:00:00 +0200
categories: system
---

# Flexible volume management

LVM2 permits you to create partitions spreading on multiple disk by grouping them in virtual volumes. It also enables the easy growing of existing partitions (but only if the filesystem permits it). That leads to a more scalable disk management because adding or deleting space is really easy without having to repartition the whole machine (most the time a server reinstallation is necessary).

## Basic notions

The method used by LVM2 to manage many disks as one unit is to group them in what is so called a volume group
For this, it is mandatory to create a physical volume, operation that prepares one partition, one entire disk or one file in a LVM2 usable format.

This can be done by the pvcreate commmand.
As an exemple, if I have one 6.4GB disk located in /dev/hdb and one 40GB disk located in /dev/hde, this is how I would initilize them :

{% highlight bash %}
osiris ~ # pvcreate /dev/hdb
Physical volume "/dev/hdb" successfully created
osiris ~ # pvcreate /dev/hde
Physical volume "/dev/hde" successfully created
{% endhighlight %}

We can verify that the two physical volumes are presented to the system using the pvdisplay command :

{% highlight bash %}
osiris ~ # pvdisplay
 --- NEW Physical volume ---
 PV Name               /dev/hde
 VG Name
 PV Size               37.27 GB
 Allocatable           NO
 PE Size (KByte)       0
 Total PE              0
 Free PE               0
 Allocated PE          0
 PV UUID               f0iIbU-ayPe-kpoy-d3bP-hfDP-JqPO-5MVLT7

 --- NEW Physical volume ---
 PV Name               /dev/hdb
 VG Name
 PV Size               6.01 GB
 Allocatable           NO
 PE Size (KByte)       0
 Total PE              0
 Free PE               0
 Allocated PE          0
 PV UUID               yV0Qht-jGSe-jdDo-jErn-cgYi-tbR6-ITqrz1
{% endhighlight %}


We now have two disks prepared to use in a volume group. It is now necessary to create a volume group using the vgcreate command (we will call the volume group in this exemple the lvmspace) :

{% highlight bash %}
osiris ~ # vgcreate lvmspace /dev/hdb
Volume group "lvmspace" successfully created
{% endhighlight %}

The volume group is now created and is of 6.1GB, fact that we can check with the vgdisplay command :

{% highlight bash %}
osiris ~ # vgdisplay
 --- Volume group ---
 VG Name               lvmspace
 System ID
 Format                lvm2
 Metadata Areas        1
 Metadata Sequence No  1
 VG Access             read/write
 VG Status             resizable
 MAX LV                0
 Cur LV                0
 Open LV               0
 Max PV                0
 Cur PV                1
 Act PV                1
 VG Size               6.00 GB
 PE Size               4.00 MB
 Total PE              1537
 Alloc PE / Size       0 / 0
 Free  PE / Size       1537 / 6.00 GB
 VG UUID               W7zp0w-pYZk-xkg1-9u37-9kiI-30uM-yA6Yji
{% endhighlight %}

![Volume group creation](../../../../assets/images/using-lvm/volume_group_creation.png)